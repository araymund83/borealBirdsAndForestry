---
title: "Checking density values for Suarez et al 2018"
author: "Tati Micheletti"
date: "7/13/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Why this file?

Talking to Nicole and Alberto to understand where the data from Alberto's `Final_points_2010.csv` 
table come from in order to be able to predict correctly using the same abundances, I came across
a situation where Alberto used a file named `DDB_BCR_PROV_LCC_Apr4-2012.csv` while Nicole suggested 
that the right densities should come from a file named `Habitat_Association_by_jurisdiction(bamddb_Apr19-2012).csv`.

Therefore, to analyze/understand how much the manuscript was affected by using a different file, I 
started the following check-up. First thing is to place both files in folder `~/inputs/`, as well as a copy of 
Alberto's `Final_points_2010.csv`.

### Loading the tables (run this using the borealBirdsAndForestry.Rproj)
```{r load_tables}
usedDens <- data.table::fread(file.path(getwd(), "inputs", "DDB_BCR_PROV_LCC_Apr4-2012.csv"))
corrDens <- data.table::fread(file.path(getwd(), "inputs", "Habitat_Association_by_jurisdiction(bamddb_Apr19-2012).csv"))
Final_table <- data.table::fread(file.path(getwd(), "inputs", "Final_points_2010.csv"))
usedDens
corrDens
```

### Testing for unique LCC and BCR values: reduced the table to the important columns: D (hopefullu stands for densiy!), LCC, BCR, PROV
```{r test_unique}
usedDens_reduced <- usedDens[,c("SPECIES", "D", "LCC", "BCR", "PROV"), with = FALSE]
corrDens_reduced <- corrDens[,c("SPECIES", "D", "LCC", "BCR", "PROV"), with = FALSE]

unique(sort(usedDens_reduced$LCC)) 
unique(sort(corrDens_reduced$LCC))
```

**Results:** Alberto's data only lacks LCC cover.

### Excluding duplicated densities 
```{r identifying_duplicates}
usedDenUnique <- unique(usedDens_reduced, by = c("SPECIES", "LCC", "BCR", "PROV"))
corrDenUnique <- unique(corrDens_reduced, by = c("SPECIES", "LCC", "BCR", "PROV"))
identical(usedDenUnique, usedDens_reduced)
identical(corrDenUnique, corrDens_reduced)
```

**Results:** Nothing to exclude, all rows are unique.

### Checking where these differ in terms of province, species and BCR
```{r identifying_differences}
usedSpec <- unique(usedDens_reduced, by = "SPECIES")
corrSpec <- unique(corrDens_reduced, by = "SPECIES") # Same number of species

usedProv <- unique(usedDens_reduced, by = "PROV")
corrProv <- unique(corrDens_reduced, by = "PROV") # Same number of provinces

usedBCR <- unique(usedDens_reduced, by = "BCR")
corrBCR <- unique(corrDens_reduced, by = "BCR") # Same number of BCR
```

**Results:** The corrected dataset lacks BCR 10 (Northern Rockies), 11 (Prairies), 13 (Lower great lakes), which means it considers only areas inside the boreal.

### Checking where these differ in terms of density values
```{r identifying_densities}
# FROM HERE ON, SORT AND COMPARE DENSITIES. THEN CHANGE DENSITIES TO THE CORRECTED AND RE-RUN THE MODELS 
sortUsed <- sort(usedDens_reduced)
sortCorr <- sort(corrDens_reduced)
```
